# Тематический лог: ARCH

Лог изменений, связанных с архитектурой, структура файлов/компонентов, JavaScript, API, I/O.

## Обновлены шапки файлов модуля кэширования с детальными объяснениями принципов
01.01.2026:cf74828 ◆ Обновлены шапки файлов модуля кэширования с объяснениями ПОЧЕМУ для каждого решения ▶ В cache-manager.js добавлено описание алгоритма getVersionedKey(), критериев версионирования ключей, методов API с примерами. В cache-config.js добавлены объяснения каждого TTL (почему именно такое значение), стратегий кэширования, версий схем. В storage-layers.js добавлены объяснения выбора слоя для каждого ключа, обоснование лимитов, правила добавления новых ключей. В cache-cleanup.js добавлены объяснения политик очистки (почему такие сроки), правил приоритетной очистки. В cache-migrations.js добавлены правила создания миграций, отличие от версионирования приложения. В cache-indexes.js добавлены объяснения выбора индексов, правил создания новых индексов. Все шапки содержат ссылки на docs/doc-cache.md для общих принципов ◉ Добавить детальные объяснения в шапки файлов кэширования для понимания принципов работы каждого модуля, обеспечить отсутствие дублирования с документацией @cache @documentation @headers @principles @architecture

<!-- ПРАВИЛА ФОРМАТИРОВАНИЯ ЗАПИСЕЙ
**КРИТИЧЕСКИ ВАЖНО**: При упоминании HTML-тегов в записях **ЗАПРЕЩЕНО** использовать обычные угловые скобки `<script>`, `<div>`, `<style>` и т.п. — они блокируют Markdown-превью. **ОБЯЗАТЕЛЬНО** использовать математические угловые скобки: ⟨script⟩, ⟨div⟩, ⟨style⟩ (U+27E8/U+27E9). Для скрытых комментариев используйте HTML-комментарии -->

## Реорганизация структуры документации: создание архива интеграций
31.12.2025:7f2d8b4 ◆ Реорганизована структура документации с созданием архива для интеграций с внешними сервисами ▶ Создана структура docs/archive/ с папками: yandex/ (документация Yandex Cloud, тестовые страницы ya-chat.html, ya-cors.html), perplexity/ (документация Perplexity AI), cloudflare/ (устаревшая документация Cloudflare Workers), gigachat/ (тестовая страница GigaChat). Все файлы перенесены в соответствующие папки с сохранением относительных ссылок. Обновлена структура основной документации: специфичная документация по интеграциям вынесена в архив, основная документация (doc-architect.md, doc-components.md) содержит только общие принципы и ссылки на архив @architecture @structure @documentation @archive @organization

## Завершение миграции на YandexGPT: добавление Folder ID, исправление ошибок чтения API ключа, улучшение реактивности, удаление инструментации
31.12.2025:59ddeda ◆ Завершена миграция на YandexGPT как дефолтный провайдер, добавлено поле Folder ID в настройки, исправлено чтение старых значений API ключа, улучшена реактивность переключения языков, удалена отладочная инструментация ▶ В ai-api-settings-template.js добавлено поле Folder ID для YandexGPT. В ai-api-settings.js добавлена поддержка Folder ID (data, computed, watch, loadSettings, saveSettings, handleCancel), исправлена кнопка "Сохранено, закрыть?" (добавлена проверка isSaved в onClick). В storage-layers.js исправлено чтение старых значений API ключа: автоматическое оборачивание строк в формат cacheManager (объект с data, version, timestamp, expiresAt). В app-ui-root.js добавлен watch на currentTranslationLanguage для реактивного обновления tooltips при смене языка. В cache-config.js добавлен ключ 'yandex-folder-id' в TTL и стратегию 'cache-only'. Удалена отладочная инструментация: в app-ui-root.js (8 блоков из testYandexAPI), yandex-provider.js (12 блоков из sendRequest), ai-provider-manager.js (5 блоков из sendRequest), gi.html (4 блока из OAuth). Обновлены комментарии в app-footer.js, tooltips-translator.js, tooltips-config.js для отражения использования aiProviderManager вместо конкретных провайдеров @yandex @migration @folder-id @api-key @reactivity @tooltips @cleanup @debug @settings @cache

## Интеграция Yandex Cloud Functions как прокси для YandexGPT API с поддержкой CORS
31.12.2025:b2db8e1 ◆ Реализована интеграция Yandex Cloud Functions как прокси-сервера для YandexGPT API с поддержкой CORS, обновлена конфигурация и провайдер для работы с прокси ▶ В app-config.js добавлен proxyUrl для YandexGPT: 'https://functions.yandexcloud.net/d4erd8d1pttbufsl26s1' (Yandex Cloud Functions прокси). Обновлен yandex-provider.js: реализована поддержка прокси через proxyUrl из конфигурации, логика выбора между прямым запросом и прокси, обработка proxyRequestBody с полями apiKey, modelUri, messages, completionOptions, корректная обработка ответа от прокси. Обновлен ai-provider-manager.js: поддержка работы с прокси через провайдер. Обновлен app-ui-root.js: поддержка новой конфигурации прокси ◉ Реализовать обход CORS ограничений YandexGPT API через прокси на базе Yandex Cloud Functions, обеспечить бесшовную интеграцию в рамках единой платформы Yandex Cloud @yandex @cloud-functions @proxy @cors @api @integration @architecture

## Создана архитектура AI провайдеров с единым интерфейсом и переключением между YandexGPT и Perplexity
30.12.2025:8a3c1eb ◆ Создана архитектура AI провайдеров с единым интерфейсом, реализован менеджер провайдеров для переключения между YandexGPT и Perplexity, создан компонент настроек AI API ▶ Создан core/api/ai-providers/base-provider.js: базовый класс BaseAIProvider с единым интерфейсом (sendRequest, getDefaultModel, getAvailableModels, getName, getDisplayName, validateApiKey). Создан core/api/ai-providers/yandex-provider.js: провайдер для YandexGPT API (endpoint llm.api.cloud.yandex.net, формат запроса с modelUri, парсинг ответа result.alternatives[0].message.text). Создан core/api/ai-providers/perplexity-provider.js: обертка над существующим perplexity.js для единого интерфейса. Создан core/api/ai-provider-manager.js: менеджер для переключения между провайдерами (getCurrentProvider, setProvider, sendRequest, getApiKey, getModel, getAvailableModels), дефолтный провайдер YandexGPT, хранение настроек в cacheManager. Создан app/components/ai-api-settings.js: компонент настроек AI API с radio buttons для выбора провайдера (YandexGPT/Perplexity), условное отображение полей настроек, сохранение настроек для обоих провайдеров отдельно. Создан app/templates/ai-api-settings-template.js: шаблон с radio buttons и условным отображением полей. Обновлен core/api/tooltips-translator.js: использование aiProviderManager вместо прямых вызовов perplexityAPI, кэширование переводов с указанием провайдера (tooltips-{provider}-{versionHash}-{language}). Обновлен app/components/app-footer.js: использование aiProviderManager для запроса новостей, проверка наличия API ключа перед запросом. Обновлен core/config/tooltips-config.js: учет провайдера при загрузке кэша переводов. Обновлен core/config/app-config.js: добавлены дефолтные значения для Yandex (folderId, model, models), дефолтный провайдер 'yandex'. Обновлен core/cache/cache-config.js: добавлены ключи 'ai-provider', 'yandex-api-key', 'yandex-model' в TTL и стратегию 'cache-only'. Обновлен core/config/modals-config.js: заменен 'perplexityModal' на 'aiApiModal' с названием "AI API". Обновлен core/modules-config.js: добавлены модули base-provider, yandex-provider, perplexity-provider, ai-provider-manager, ai-api-settings-template, ai-api-settings, обновлены зависимости. Обновлен app/app-ui-root.js: заменен perplexity-settings на ai-api-settings, обновлен метод openAiApiModal(). Обновлен index.html: заменены ссылки на новый компонент ai-api-settings. Исправлен порядок регистрации кнопок в ai-api-settings.js (кнопки регистрируются до загрузки настроек) ◉ Обеспечить возможность переключения между AI провайдерами (YandexGPT, Perplexity), централизовать управление настройками AI API, упростить добавление новых провайдеров в будущем, обеспечить отдельное кэширование для каждого провайдера @ai-providers @architecture @yandex @perplexity @provider-manager @settings @radio-buttons @cache @single-source-of-truth @refactoring

## Добавлена поддержка long press tooltips на мобильных и система перевода tooltips через Perplexity AI
30.12.2025:4234049 ◆ Добавлена поддержка long press для tooltips на мобильных устройствах и реализована система перевода tooltips через Perplexity AI ▶ В button.js и dropdown-menu-item.js добавлен метод initTouchTooltips(): автоматическое определение touch-устройств (проверка 'ontouchstart' в window или navigator.maxTouchPoints, дополнительная проверка размера экрана для DevTools), замена нативных tooltips (title) на Bootstrap tooltips с manual trigger, обработка long press (500ms) с показом tooltip, скрытие при клике вне области через обработчик на document, обновление tooltips при смене языка через watch на props и updated() hook. Создан core/config/tooltips-config.js: централизованная конфигурация всех tooltips (51 русский tooltip), функции getTooltip(key), init(language), getCurrentLanguage(), кэширование переводов с версионированием ключа (tooltips-{versionHash}-{language}). Создан core/api/tooltips-translator.js: модуль перевода всех tooltips через Perplexity AI единым запросом с парсингом ответа по разделителям (---TOOLTIP:ключ---), сохранение переводов в cacheManager с версионированным ключом. Обновлен app-ui-root.js: добавлены tooltipsConfig и currentTranslationLanguage в data(), метод updateTooltips() для обновления реактивных tooltips, инициализация tooltips при mounted() и обновление при смене языка в saveTimezone(), добавлен тестовый пример в index.html. Обновлен core/modules-config.js: добавлены tooltips-config и tooltips-translator. Обновлен cache-config.js: добавлен 'translation-language' в стратегию 'cache-only'. Удалены все отладочные console.log, оставлены только критичные console.error ◉ Реализовать поддержку tooltips на мобильных устройствах через long press, централизовать конфигурацию tooltips, добавить систему перевода tooltips через Perplexity AI с кэшированием и версионированием @tooltips @mobile @long-press @translation @perplexity @cache @versioning @single-source-of-truth @bootstrap

## Добавление crypto-news-state к версионируемым ключам, критерии применения версионирования кэша
30.12.2025 ◆ Добавлен crypto-news-state к версионируемым ключам кэша, документированы критерии применения версионирования, обновлены правила для агента ▶ В cache-manager.js добавлен 'crypto-news-state' в список versionedKeys с комментарием о зависимости от структуры промпта Perplexity. В doc-architect.md добавлен раздел "Критерии применения версионирования кэша" с правилами: версионировать данные из внешних API, парсируемые данные, данные зависящие от структуры приложения; не версионировать пользовательские данные, настройки, UI-состояние, данные с миграциями. Добавлен раздел "Для агента при разработке новой функциональности" с пошаговой инструкцией проверки необходимости версионирования. В .cursorrules добавлено требование проверки версионирования при добавлении новых ключей кэша через cacheManager.get/set() ◉ Обеспечить автоматическую инвалидацию кэша новостей при обновлении приложения, документировать критерии для проактивной проверки версионирования при разработке @cache @versioning @crypto-news-state @documentation @criteria @agent-rules

## Удаление отладочной инструментации, исправление доступности, централизация конфигурации
30.12.2025 ◆ Удалена отладочная инструментация, исправлена доступность модальных окон, централизована конфигурация модальных окон, удалены старые примеры с традиционными слотами ▶ В perplexity-settings.js, modal-buttons.js, modal.js удалены все блоки `// #region agent log` с fetch-запросами к `127.0.0.1:7243/ingest/`. В modal.js добавлена обработка фокуса в метод hide() и событие hide.bs.modal для предотвращения ошибки доступности "Blocked aria-hidden on an element because its descendant retained focus" (удаление фокуса с активного элемента и перемещение на body перед закрытием). Создан core/config/modals-config.js: централизованная конфигурация модальных окон (заголовки, иконки, описания) с функциями getModalTitle(), getModalIcon(), getModalConfig(). Обновлен modal.js: добавлен prop title, computed modalTitle (приоритет: prop > modalsConfig > null), предоставление modalApi.title через provide. Обновлен modal-template.js: автоматическое отображение заголовка из modalTitle если нет слота header. Обновлен app-ui-root.js: удалены методы openExampleModal() и closeExampleModal(), загружается modalsConfig в data(). Обновлен index.html: удалены старые примеры модальных окон exampleModalStatic и exampleModal с традиционными слотами #footer, обновлено описание (все модальные окна используют modalApi). Обновлен core/modules-config.js: добавлен модуль modals-config, добавлена зависимость modals-config для modal. Обновлен app-footer.js и perplexity-settings.js: проверено отсутствие хардкода API ключа (defaultApiKey = '') ◉ Очистить production код от отладочной инструментации, исправить проблемы доступности, централизовать конфигурацию модальных окон, удалить устаревшие примеры @cleanup @debug @accessibility @modal @config @single-source-of-truth @refactoring

## Интеграция Perplexity AI и рефакторинг получения новостей
30.12.2025:1a9a1e1 ◆ Интегрирован Perplexity AI для получения новостей крипты и реализована ленивая загрузка новостей по требованию ▶ Создан core/api/perplexity.js: модуль для взаимодействия с Perplexity Chat Completions API (sendPerplexityRequest). Создан app/components/perplexity-settings.js: компонент настроек Perplexity (API ключ, модель) с использованием системы управления кнопками модального окна. Создан app/templates/perplexity-settings-template.js: шаблон для настроек Perplexity. Обновлен app/components/app-footer.js: реализована ленивая загрузка новостей (fetchSingleCryptoNews по индексу 0-4), парсинг одной новости с переводом по маркерам (---NEWS---, ---TRANSLATION---, ---END---), очистка артефактов (цифры-сноски после точек), сохранение только индекса текущей новости в кэше. Обновлен core/cache/cache-config.js: добавлены 'perplexity-api-key' и 'perplexity-model' в TTL и стратегию 'cache-only'. Обновлен core/modules-config.js: зарегистрированы perplexity, perplexity-settings-template, perplexity-settings. Обновлен app/app-ui-root.js: зарегистрирован perplexity-settings, добавлен метод openPerplexityModal(). Исправлена система управления кнопками модального окна: добавлен компонент cmp-modal-buttons в cmp-modal, исправлена реактивность через buttonsUpdateCounter, добавлена зависимость modal-buttons в modules-config. Исправлено закрытие модального окна: добавлен метод closeModal() с удалением фокуса перед закрытием для устранения ошибки доступности ◉ Интегрировать Perplexity AI для получения актуальных новостей крипты, реализовать ленивую загрузку для экономии API квоты, обеспечить корректную работу системы управления кнопками модального окна @perplexity @api @news @lazy-loading @modal @buttons @accessibility @cache

## Система управления кнопками модального окна через provide/inject
30.12.2025:564cf4d ◆ Реализована единая система управления кнопками в header и footer модального окна через provide/inject ▶ В cmp-modal.js добавлен provide() с modalApi (registerButton, updateButton, removeButton, getButton, getButtonsForLocation), единый реестр кнопок через Map, методы регистрации/обновления/удаления кнопок с указанием мест отображения (header, footer или оба). Создан cmp-modal-buttons.js: компонент для рендеринга кнопок в указанном месте через inject modalApi. Создан modal-buttons-template.js: шаблон для рендеринга списка кнопок через cmp-button. Обновлен modal-template.js: добавлена поддержка динамических кнопок через cmp-modal-buttons в header и footer. Создан modal-example-body.js: пример компонента с регистрацией кнопок через inject. Создан timezone-selector.js: переиспользуемый компонент выбора таймзоны для устранения дублирования. Обновлен core/modules-config.js: зарегистрированы modal-buttons, modal-buttons-template, modal-example-body, timezone-selector. Обновлен app-ui-root.js: зарегистрирован cmp-modal-buttons, modal-example-body, добавлена проверка компонентов ◉ Реализовать единую систему управления кнопками модального окна с возможностью отображения одной кнопки в нескольких местах без дублирования функциональности, обеспечить реактивное обновление состояния @modal @provide-inject @architecture @components @buttons @single-source-of-truth

## Закрытие dropdown при отпускании кнопки мыши
30.12.2025:06b8acc ◆ Добавлено автоматическое закрытие dropdown при отпускании кнопки мыши на элементе меню ▶ В dropdown-menu-item.js добавлен метод closeParentDropdown(): находит родительский dropdown через closest('.dropdown'), получает Bootstrap Dropdown instance через Dropdown.getInstance() и закрывает через hide(). Метод вызывается во всех обработчиках (handleClick, handleIconClick, handleTextClick, handleSuffixClick) перед эмитом событий. Обновлена документация компонента с описанием нового поведения ◉ Улучшить UX: закрывать dropdown при отпускании кнопки мыши, а не при нажатии @dropdown @dropdown-menu-item @ux @mouseup @bootstrap

## Реализация функциональности метрик рынка в футере
30.12.2025:769b0a9 ◆ Создан модуль market-metrics.js и реализована функциональность отображения метрик рынка в футере ▶ Создан core/api/market-metrics.js: модуль для получения метрик рынка (FGI, VIX с fallback-стратегией из 3 источников, BTC Dominance, Open Interest, Funding Rate, Long/Short Ratio). Обновлен app-footer.js: добавлены данные метрик (строковые и числовые значения), методы fetchMarketIndices(), getMSKTime(), getNextUpdateTime(), scheduleNextUpdate(), formatOIMobile(), formatValueMobile(). Реализовано автоматическое обновление метрик 3 раза в день (09:00, 12:00, 18:00 МСК). Обновлен core/modules-config.js: добавлен модуль market-metrics в секцию core, добавлена зависимость market-metrics для app-footer ◉ Реализовать отображение метрик рынка в футере приложения с автоматическим обновлением по расписанию @footer @api @market-metrics @architecture @modules @scheduling

## Исправление зависимостей app-ui-root
29.12.2025:73419f5 ◆ Добавлены отсутствующие зависимости app-header и app-footer в modules-config.js ▶ В core/modules-config.js обновлен массив deps для модуля app-ui-root: добавлены 'app-header' и 'app-footer'. Это исправляет потенциальную ошибку инициализации "не все компоненты загружены", так как app-ui-root проверяет наличие window.appHeader и window.appFooter, но эти модули не были указаны в зависимостях ◉ Исправить баг с зависимостями модулей, обеспечить корректную загрузку компонентов макета @fix @dependencies @modules-config @app-ui-root

## Рефакторинг структуры стилей и создание компонентов макета
29.12.2025:599488f ◆ Реорганизована структура стилей и созданы компоненты макета ▶ Перемещена папка app/styles/ → styles/ в корень проекта. Переименована папка components → wrappers для оберток над Bootstrap. Создана структура styles/layout/ для компонентов макета. Созданы компоненты app-header и app-footer: шаблоны (app/templates/), компоненты (app/components/), стили (styles/layout/). Зарегистрированы компоненты в core/modules-config.js и app/app-ui-root.js. Обновлена классификация компонентов: 3 типа (Bootstrap Wrappers, Layout Components, Custom Components) ◉ Улучшить организацию структуры проекта, создать переиспользуемые компоненты макета, систематизировать классификацию компонентов @refactoring @structure @components @layout @architecture @organization

## Реализация переключения темы приложения
29.12.2025:caef730 ◆ Реализована система переключения темы Light | Dark через Bootstrap data-bs-theme ▶ В app-ui-root.js добавлен метод toggleTheme(): переключение темы, сохранение через window.cacheManager.set('theme'), применение data-bs-theme к ⟨body⟩. Добавлена синхронная инициализация темы в data() с чтением из localStorage для избежания мерцания. В core/cache/cache-config.js добавлен 'theme': null в TTL и 'theme' в стратегию 'cache-only'. Тема сохраняется в слое hot (localStorage) через систему кэширования проекта ◉ Реализовать переключение темы приложения с сохранением в localStorage через единую систему кэширования, обеспечить синхронную инициализацию без мерцания @theme @cache @localStorage @bootstrap @ui

## Удаление debug-инструментации из компонентов
29.12.2025:6fad634 ◆ Удалены все блоки debug-логирования через fetch-запросы к локальному серверу ▶ В button.js удален блок `// #region agent log` с fetch-запросом из `buttonClasses()`. В button-group.js удален блок из `groupClasses()`. В dropdown.js удалены 3 блока из `dropdownClasses()` и `buttonClassesForDropdown()` (ENTRY и EXIT). Все fetch-запросы к `127.0.0.1:7243/ingest/` удалены, что устраняет ошибки `ERR_CONNECTION_REFUSED` в консоли браузера ◉ Очистить production код от debug-инструментации, устранить ошибки подключения к несуществующему серверу @components @cleanup @debug @button @button-group @dropdown

## Упрощение валидатора verticalBreakpoint в button-group
28.12.2025:0c326d2 ◆ Упрощен валидатор prop verticalBreakpoint после удаления неиспользуемых breakpoints ▶ В button-group.js обновлен валидатор verticalBreakpoint: изменен с ['sm', 'md', 'lg', 'xl', 'xxl'] на value === 'sm' (теперь принимает только 'sm' или null). В docs/doc-components.md обновлено описание prop verticalBreakpoint: указано, что поддерживается только 'sm' (576px) ◉ Упростить валидацию после удаления неиспользуемых breakpoints, обновить документацию @components @button-group @validation @refactoring

## Добавление горизонтальных отступов mx-1 для иконок, текста и суффиксов в кнопках
28.12.2025:acc1a48 ◆ Добавлены минимальные горизонтальные отступы mx-1 для всех элементов кнопки через Bootstrap классы ▶ В button.js добавлен mx-1 в baseClasses для iconClasses(), labelClasses() и suffixClasses(). Для суффикса заменён ms-1 на mx-1 для симметричных отступов. Удалены debug fetch вызовы из iconClasses(), labelClasses(), suffixClasses(). В button-template.js удалены inline стили aspectRatio, width и marginRight из обертки иконки, отступы теперь управляются только через Bootstrap классы ◉ Обеспечить единообразные минимальные горизонтальные отступы для всех элементов кнопки (иконка, текст, суффикс) через нативные Bootstrap классы @components @button @spacing @bootstrap @refactoring

## Добавлена утилита layout-sync для автоматической синхронизации padding body с высотой header/footer
28.12.2025:df28d9c ◆ Создана утилита для автоматической синхронизации padding-top и padding-bottom body с высотой фиксированных header и footer ▶ Создан shared/utils/layout-sync.js: утилита отслеживает высоту header и footer через ResizeObserver (изменения размеров) и MutationObserver (изменения атрибутов, дочерних элементов, поддерева), автоматически устанавливает padding-top и padding-bottom для body, использует CSS переменные --header-height и --footer-height для нативного подхода. Обновлён core/modules-config.js: добавлен модуль layout-sync в секцию utilities. Обновлён index.html: убраны фиксированные классы pt-5 pb-5 из body, padding теперь устанавливается динамически через утилиту. Утилита автоматически запускается при загрузке DOM, поддерживает ручное управление через window.layoutSync.start(), stop(), update() ◉ Обеспечить математически точное резервирование места под фиксированные header и footer без перекрытия контента, поддержать динамические изменения высоты header/footer @utilities @layout @header @footer @responsive @automation

## Исправления механизма classesAdd/classesRemove и ревизия компонентов
28.12.2025:3b672e1 ◆ Исправлены критические баги механизма управления классами и проведена ревизия всех компонентов ▶ В class-manager.js изменён порядок обработки классов: сначала удаление (classesRemove), затем добавление (classesAdd) для предсказуемого поведения. В button-template.js удалён жестко заданный class="p-0" с кнопки. В button-group-template.js заменён старый проп :class на :classes-add для cmp-button, добавлены классы d-flex align-items-center к label для checkbox/radio. В dropdown.js и button-group.js все computed свойства (buttonClassesForDropdown, dropdownClassesForGroup и т.д.) теперь возвращают объекты с фиксированной структурой (все ключи присутствуют, даже если значение undefined) для обеспечения реактивности Vue. В dropdown.js добавлена поддержка buttonContainer для управления классами контейнера кнопки. В button.js добавлено управление классами для container через containerClasses() с поддержкой classesAdd.container и classesRemove.container ◉ Исправить критические баги с реактивностью и применением классов, обеспечить системное использование механизма во всех компонентах, исправить проблемы с выравниванием кнопок @components @classes @fix @reactivity @refactoring @button-group @dropdown @button @class-manager

## Реализация универсального механизма управления CSS классами
28.12.2025:f8d48f6 ◆ Реализован универсальный механизм управления CSS классами через classesAdd/classesRemove для всех компонентов ▶ Создан shared/utils/class-manager.js: утилита processClasses() и processClassesToString() для добавления и удаления классов из базовых массивов. Обновлён core/modules-config.js: добавлен class-manager в utilities. Мигрированы все компоненты: удалён prop class, добавлены props classesAdd и classesRemove (Object, default {}). В cmp-button: управление классами для root, icon, label, suffix через computed свойства iconClasses(), labelClasses(), suffixClasses(). В cmp-dropdown: управление для root, button, menu через buttonClassesForDropdown(), menuClassesComputed(). В cmp-dropdown-menu-item: управление для root, icon, subtitle, suffix. В cmp-combobox: управление для root, menu. В cmp-button-group: управление для root, dropdown, dropdownButton, dropdownMenu. Все computed свойства используют window.classManager.processClassesToString() с проверкой доступности утилиты. Исправлена ошибка: getParentContext() перемещена из computed в methods. Обновлены все шаблоны для использования новых computed свойств ◉ Обеспечить гибкое управление CSS классами на различных внутренних элементах компонентов, заменить устаревший prop class на универсальный механизм с поддержкой добавления и удаления классов @components @architecture @refactoring @classes @class-manager @migration

## Исправления button-group: порядок событий и добавление prop dropdownSize
28.12.2025 ◆ Исправлен порядок эмиссии событий для checkbox и добавлен prop dropdownSize ▶ В button-group.js исправлен порядок эмиссии событий в handleMenuClick для checkbox: теперь button-change → button-toggle (консистентно с handleButtonChange и radio). Добавлен prop dropdownSize с валидатором (sm, lg) и computed свойство computedDropdownSize для независимого управления размером dropdown кнопки. Обновлён button-group-template.js: заменено :button-size="size" на :button-size="computedDropdownSize" ◉ Обеспечить консистентный порядок событий для всех типов кнопок и независимое управление размером dropdown кнопки @components @button-group @fix @events @props @consistency

## Исправления логики button-group: radio поведение и порядок эмиссии событий
28.12.2025 ◆ Исправлены ошибки в логике button-group для корректной работы radio и консистентности событий ▶ В button-group.js исправлена логика handleMenuClick для radio кнопок: убрано переключение состояния (const newActive = !state.active), добавлена проверка !state.active перед активацией (radio нельзя деактивировать кликом, только выбором другого radio). Исправлен порядок эмиссии событий в handleMenuClick: теперь button-change → button-toggle (как в handleButtonChange), вместо button-toggle → button-change ◉ Обеспечить нативное поведение radio кнопок (нельзя деактивировать кликом) и консистентный порядок эмиссии событий для всех путей взаимодействия @components @button-group @fix @radio @events @consistency

## Создание Vue-компонента button-group
28.12.2025 ◆ Создан компонент button-group — обёртка над Bootstrap .btn-group ▶ Создан shared/components/button-group.js: компонент с поддержкой трёх типов кнопок (button через cmp-button, checkbox и radio через нативный HTML), наследованием variant и size от группы, адаптивным схлопыванием в dropdown при брейкпоинте через двойной рендер с CSS-переключением (d-none d-{breakpoint}-inline-flex), синхронизацией состояния через внутреннее buttonStates, автоматическим сбросом других radio при выборе. Создан shared/templates/button-group-template.js: шаблон с двойным рендером (группа кнопок для ≥ breakpoint, dropdown для < breakpoint), маппингом buttons в menuItems для dropdown. Обновлён core/modules-config.js: добавлен шаблон button-group-template и компонент button-group с зависимостями. Обновлён app/app-ui-root.js: зарегистрирован компонент cmp-button-group, добавлен метод handleButtonGroupClick ◉ Создать универсальный компонент группы кнопок с поддержкой всех типов кнопок Bootstrap, адаптивностью и максимальной совместимостью с Bootstrap JS API @components @bootstrap @button-group @adaptivity @vue

## Ревизия шапок файлов на соответствие иерархии уровней
27.12.2025:b876f35 ◆ Проведена ревизия шапок файлов на соответствие иерархии уровней документирования ▶ В shared/utils/auto-markup.js расширена шапка с деталями реализации (правила применения, особенности), добавлены ссылки на общую документацию. В shared/templates/button-template.js убрано упоминание об адаптивности (общий принцип). В shared/components/button.js переформатирована шапка, убраны общие принципы, оставлено только специфичное для компонента, добавлены ссылки на общую документацию. В core/module-loader.js обновлена шапка с корректными деталями реализации, добавлены ссылки на общую документацию ◉ Привести шапки файлов в соответствие с иерархией уровней документирования, убрать общие принципы, оставить только специфичное для файла, обеспечить согласованность ссылок @documentation @refactoring @hierarchy @headers

## Вынос шаблонов компонентов в отдельные файлы
27.12.2025:0258094 ◆ Вынесены шаблоны компонентов из core/templates-inline.js в отдельные файлы в shared/templates/ ▶ Созданы 4 файла шаблонов: shared/templates/button-template.js, dropdown-menu-item-template.js, dropdown-template.js, combobox-template.js. Каждый файл содержит шапку документации с ЦЕЛЬ, ПРОБЛЕМА, РЕШЕНИЕ, КАК ДОСТИГАЕТСЯ, ОСОБЕННОСТИ ШАБЛОНА, ССЫЛКИ на общую документацию. Обновлён core/modules-config.js: добавлены 4 отдельных шаблона вместо templates-inline, обновлены зависимости Vue.js и app-ui-root. Обновлён core/module-loader.js: обновлена проверка критичных модулей для всех шаблонов. Удалён core/templates-inline.js. Удалены отладочные логи из core/module-loader.js, app/app-ui-root.js, shared/utils/auto-markup.js ◉ Разделить шаблоны на отдельные файлы для лучшей организации и документирования, обеспечить единообразную структуру шапок с ссылками на общую документацию @templates @refactoring @documentation @modules

## Реализация модульной системы загрузки скриптов
27.12.2025:2b7723c ◆ Реализована модульная система загрузки скриптов с автоматическим разрешением зависимостей ▶ Создан core/modules-config.js: централизованная конфигурация всех модулей приложения с описанием зависимостей, группировка по категориям (utilities, core, templates, libraries, components, app). Создан core/module-loader.js: загрузчик модулей с топологической сортировкой (алгоритм Kahn), обнаружением циклических зависимостей, поддержкой file:// и http:// протоколов через асинхронную загрузку ⟨script⟩ тегов, кэшированием загруженных модулей, улучшенной обработкой ошибок (критичные модули прерывают загрузку, некритичные продолжают), условной загрузкой модулей через feature flags (опциональное поле condition). Обновлён app/app-ui-root.js: убрана загрузка компонентов (теперь только инициализация Vue), компоненты загружаются через модульную систему. Обновлён index.html: заменена прямая загрузка модулей на модульную систему (подключение modules-config.js и module-loader.js). Удалены core/template-loader.js и shared/templates/*.html (шаблоны вынесены в shared/templates/*.js) ◉ Централизовать управление зависимостями модулей, автоматизировать порядок загрузки, упростить добавление новых модулей, обеспечить поддержку file:// и http:// протоколов @architecture @modules @loader @dependencies @refactoring @file-protocol

## Добавление утилиты pluralize и выравнивание высоты компонентов
27.12.2025:5cc7037 ◆ Добавлена утилита pluralize и реализовано выравнивание высоты через вертикальный padding ▶ Создан shared/utils/pluralize.js: утилита для склонения русских числительных (window.pluralize). В button.js обновлён метод containerClasses(): убран жёстко заданный py-2, оставлены только d-flex align-items-center для управления вертикальным padding через CSS. Вертикальный padding теперь управляется через CSS в responsive-breakpoints.css на основе классов размеров Bootstrap (btn-sm, btn-lg) ◉ Добавить утилиту для локализации и реализовать метод выравнивания высоты элементов для консистентности интерфейса @utilities @localization @alignment @components @css

## Исправление ошибки filteredItems и рефакторинг dropdownClasses в dropdown
26.12.2025:7e0bc9a ◆ Исправлена ошибка "Cannot read properties of undefined (reading 'length')" в компоненте dropdown и перенесён класс dropdown-responsive на корневой элемент ▶ В dropdown.js исправлено computed свойство filteredItems: добавлена защита от undefined/null items (const items = this.items || []), все обращения к this.items заменены на items. Добавлено computed свойство dropdownClasses() для корневого элемента dropdown: включает классы dropdown, dropdown-responsive, instanceHash и условные классы has-icon, has-text-short. Удалён класс dropdown-responsive из buttonClasses() (теперь только btn, btn-{variant}, dropdown-toggle, btn-{size}). Обновлён шаблон dropdown-template: корневой div использует :class="dropdownClasses" вместо class="dropdown", добавлена проверка filteredItems && перед обращением к .length в условии пустого состояния поиска ◉ Исправить ошибку рендеринга dropdown при отсутствии prop items и правильно разместить класс dropdown-responsive на корневом элементе для корректной работы CSS селекторов @components @dropdown @fix @bug @refactoring

## Система автоматической маркировки элементов и детерминированных хэшей
26.12.2025:39b3a5e ◆ Реализована система автоматической маркировки элементов DOM и детерминированных хэшей для компонентов ▶ Создан shared/utils/hash-generator.js: утилита генерации детерминированных Base58 хэшей из строк (алгоритм djb2). Создан shared/utils/auto-markup.js: утилита автоматической маркировки значимых контейнеров через MutationObserver (работает с асинхронной загрузкой). Добавлен computed instanceHash в button.js, dropdown.js, dropdown-menu-item.js: генерация детерминированного хэша на основе родительского контекста (класс avto-* или ID родителя) и идентификатора экземпляра из props (buttonId, itemId, dropdownId или fallback). Добавлен метод getParentContext() во все компоненты: поиск родительского контекста через обход DOM (до 5 уровней). Хэш автоматически добавляется к корневым элементам компонентов через buttonClasses, itemClasses. Добавлены props buttonId в button.js и itemId в dropdown-menu-item.js для явной идентификации экземпляров. Инициализация auto-markup в app/app-ui-root.js после монтирования Vue приложения. Подключение утилит в index.html (до Vue.js) ◉ Обеспечить автоматическую маркировку всех значимых элементов DOM и уникальную идентификацию экземпляров компонентов для навигации в коде и кастомной стилизации @utilities @markup @hash @components @vue @mutation-observer

## Рефакторинг адаптивности: удаление responsive prop из компонентов
26.12.2025:90b50ff ◆ Удалён responsive prop и все computed свойства для breakpoints из компонентов, адаптивность перенесена в CSS ▶ В button.js убран responsive prop, удалены computed свойства iconClasses, labelClasses, labelShortClasses, iconDataAttrs, labelShortDataAttrs, labelDataAttrs. Добавлены условные классы has-icon и has-label-short в buttonClasses. В dropdown.js убран responsive prop, удалены computed свойства buttonIconClasses, buttonTextShortClasses, buttonTextClasses. Добавлены условные классы has-icon и has-text-short в buttonClasses. В dropdown-menu-item.js убран responsive prop, удалены computed свойства iconClasses и subtitleClasses, добавлен computed itemClasses для класса компонента. Обновлены шаблоны: классы элементов (.icon, .label, .label-short, .suffix) добавляются напрямую, без computed свойств ◉ Упростить компоненты, убрать логику адаптивности из JavaScript, перенести её в CSS через классы компонентов @components @adaptivity @refactoring @vue @css

## Добавление адаптивности в компоненты button и dropdown
23.12.2025:a4dc95b ◆ Добавлена адаптивность для мобильных устройств в компоненты button и dropdown ▶ В button.js добавлен prop labelShort для укороченной версии текста на мобильных (если нет иконки). В dropdown.js добавлены props buttonIcon (иконка для мобильной версии), buttonTextShort (укороченный текст, если нет иконки) и responsive (объект с настройками адаптивности: hideTextOnMobile, showIconOnMobile, useShortTextOnMobile). Обновлены шаблоны в core/templates-inline.js: для button добавлена логика отображения labelShort на мобильных при отсутствии иконки, для dropdown добавлена логика отображения buttonIcon на мобильных и buttonTextShort при отсутствии иконки. Обновлены примеры в index.html для демонстрации адаптивности ◉ Реализовать единый подход к адаптивности текстового содержимого на мобильных устройствах для компонентов button и dropdown @components @adaptivity @responsive @mobile @button @dropdown

## Вынос шаблонов и логики инициализации из index.html
23.12.2025:8559968 ◆ Вынесены шаблоны компонентов и логика инициализации Vue из index.html в отдельные модули ▶ Создан core/templates-inline.js для хранения шаблонов как строк в JavaScript объекте (работает с file:// протоколом через обычный ⟨script⟩ тег). Создан app/app-ui-root.js с логикой загрузки компонентов и инициализации Vue приложения. Обновлён index.html: удалены встроенные шаблоны (~370 строк) и логика инициализации (~130 строк), добавлены подключения новых модулей. Шаблоны загружаются через обычный ⟨script⟩ тег, что работает и с file://, и с HTTP/HTTPS. Создан core/template-loader.js для будущего использования с HTTP/HTTPS через XMLHttpRequest ◉ Разгрузить index.html, вынести шаблоны и логику инициализации в отдельные модули, сохранить работоспособность с file:// протоколом @refactoring @templates @vue @file-protocol @modularity @index

## Исправление работы приложения с file:// протоколом
23.12.2025:ca794ba ◆ Исправлена работа приложения при открытии из локальной папки: заменён Vue development build на production build, встроены шаблоны компонентов в index.html вместо загрузки через fetch (для обхода CORS ограничений file:// протокола), добавлены проверки на существование элементов в dropdown.js и dropdown-menu-item.js перед обращением к DOM @vue @production @file-protocol @cors @fix @templates @components

## Создание Vue-компонента-обёртки над Bootstrap dropdown
23.12.2025:3c7811a ◆ Создан Vue-компонент-обёртка над Bootstrap dropdown с поддержкой поиска и прокрутки ▶ Создан шаблон `shared/templates/dropdown-template.html` с поддержкой поиска, прокрутки, слотов для гибкого использования. Создан компонент `shared/components/dropdown.js` с props, emits, методами программного управления через Bootstrap API. Реализована стратегия максимальной совместимости с Bootstrap JS API: инициализация через `new bootstrap.Dropdown()`, подписка на события Bootstrap (`show.bs.dropdown`, `hide.bs.dropdown`), методы `show()`, `hide()`, `toggle()`, `getBootstrapInstance()` для прямого доступа к Bootstrap API, уничтожение экземпляров в `beforeUnmount()`. Поддержка поиска с встроенной фильтрацией и кастомными функциями, прокрутка для длинных списков, слоты для кастомной кнопки и элементов списка. Обновлён index.html с примерами компонента (базовый, с поиском, с прокруткой, комбинированный). Обновлена документация в docs/doc-components.md: добавлен раздел о компоненте dropdown, добавлена стратегия максимальной совместимости с Bootstrap как обязательное требование, обновлено оглавление ◉ Создать Vue-обёртку над Bootstrap dropdown с дополнительной функциональностью (поиск, прокрутка) при сохранении полной совместимости с Bootstrap JS API @components @vue @bootstrap @dropdown @shared @bootstrap-api

## Создание компонента button
23.12.2025:bb969e5 ◆ Создан переиспользуемый компонент button для кнопок с иконкой, текстом и суффиксом ▶ Создан шаблон `shared/templates/button-template.html` с поддержкой иконки, текста, суффикса (массив badge/icon/indicator/chevron/info), tooltips, состояний (disabled/loading), вариантов Bootstrap, размеров. Создан компонент `shared/components/button.js` с props, emits, computed свойствами. Реализована логика событий: по умолчанию все зоны эмитят общий click, раздельные события (click-icon, click-text, click-suffix) эмитятся всегда. Настроены паддинги (px-3 py-2, px-md-3 py-md-2), gap между тап-зонами (me-1/ms-1), обесцвечивание disabled кнопок через нейтральные классы Bootstrap. Фиксированная ширина контейнера иконки (1.6em) с выравниванием по центру через text-center. Нативные подсказки браузера через атрибут title. Запрет переноса строк для текста кнопок (text-nowrap). Обновлён index.html с примерами компонента в разных состояниях. Обновлена документация в docs/doc-components.md ◉ Создать универсальный переиспользуемый компонент для кнопок с поддержкой всех необходимых функций, используя только Bootstrap классы @components @vue @bootstrap @button @shared

## Создание компонента dropdown-menu-item
23.12.2025:4cb4b35 ◆ Создан переиспользуемый компонент dropdown-menu-item для пунктов выпадающего меню ▶ Создан шаблон `shared/templates/dropdown-menu-item-template.html` с поддержкой иконки, заголовка, подзаголовка, суффикса (badge/icon/indicator/chevron/info), tooltips, состояний (active/disabled). Создан компонент `shared/components/dropdown-menu-item.js` с props, emits, методами обработки кликов. Реализована логика событий: по умолчанию все зоны эмитят общий click, раздельные события (click-icon, click-text, click-suffix) эмитятся всегда. Добавлена анимация chevron через Font Awesome классы (fa-rotate-90) + inline transition. Инициализация Bootstrap tooltips через data-bs-toggle. Обновлён index.html с примерами компонента в разных состояниях ◉ Создать универсальный переиспользуемый компонент для пунктов dropdown-меню с поддержкой всех необходимых функций, используя только Bootstrap классы @components @vue @bootstrap @dropdown @menu-item @shared

## Обновление формата записей в тематических логах
22.12.2025:f033986 ◆ Обновлён формат записей в тематических логах для компактности @logs @format @refactoring

## Обновление ссылок на переименованные файлы документации
22.12.2025:dff9953 ◆ Обновлены ссылки на переименованный файл документации в `core/lib-loader.js` @refactoring @links @lib-loader

## Создание загрузчика библиотек с fallback-механизмом
22.12.2025:2b7d0a8 ◆ Создан `core/lib-loader.js` для загрузки внешних библиотек с автоматическим fallback ▶ Реализованы функции: `load()`, `loadMultiple()`, `isLoaded()`, `addSource()`. Поддержка GitHub Pages CDN как основной источник, внешние CDN как fallback, кэширование загруженных библиотек. Поддержка библиотек: vue, chartjs, numeral, vuedraggable, dayjs. Обновлён порядок загрузки в `docs/doc-architect.md` ◉ Обеспечить надёжную загрузку библиотек независимо от доступности отдельных CDN, централизовать управление библиотеками @architect @lib-loader @cdn @fallback

## Создание критически важных структур проекта
22.12.2025:68e89b3 ◆ Созданы все критически важные структуры для здоровья проекта ▶ Создана структура `core/validation/` (schemas.js, validator.js, normalizer.js, math-validation.js). Создана структура `core/errors/` (error-types.js, error-handler.js). Создан `core/api/rate-limiter.js`. Создана структура `core/state/` (loading-state.js). Создана структура `core/events/` (event-bus.js). Создана структура `core/config/` (app-config.js, api-config.js). Создана структура `core/logging/` (logger.js). Обновлена документация `docs/doc-architect.md`: добавлен раздел "Критически важные структуры", обновлён порядок загрузки (15 шагов). Всего создано 19 файлов, 2268 строк JavaScript кода ◉ Заложить фундамент для надёжности финансовых расчётов, предотвратить ошибки из-за некорректных данных, обеспечить единообразную обработку ошибок и состояний @architect @validation @errors @rate-limiting @state @events @config @logging @foundation

## Декомпозиция ui/ и переименование в shared/
22.12.2025:37235af ◆ Переименована папка `ui/shared/` → `shared/`, обновлена структура проекта ▶ Переименована папка `ui/shared/` в `shared/`, удалена пустая папка `ui/`, обновлены все упоминания в `index.html`, создана структура папок: `shared/` (components, styles, templates, utils, config, assets/icons), `features/markets/`, `features/settings/`, `features/layout/` с подпапками ◉ Упростить структуру проекта, убрать лишний уровень вложенности, обеспечить чёткое разделение shared/feature-specific компонентов @architect @structure @refactoring @shared @features

## Создание модульного index.html с принципами модульности
22.12.2025:822e4e4 ◆ Создан `index.html` как точка подключения скриптов с развёрнутой шапкой, описывающей принципы модульности ▶ Добавлена шапка с описанием: вынос x-template шаблонов в отдельные файлы, модульная система загрузки скриптов через конфигурацию, группировка компонентов по функциональности и слоям, правила размещения файлов, порядок загрузки, принципы именования, работа без сборки ◉ Обеспечить модульную архитектуру проекта, избежать раздувания index.html, централизовать управление загрузкой модулей @architect @modularity @index @module-loader
