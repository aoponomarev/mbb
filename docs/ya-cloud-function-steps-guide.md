# Пошаговое руководство: Создание версии Cloud Function

## Шаг 1: Открыть функцию в консоли

### Способ 1: Клик по имени функции (самый простой)

1. На странице списка функций найдите функцию **`yandexgpt-proxy`**
2. **Кликните на имя функции** `yandexgpt-proxy` (клик по тексту, не по чекбоксу)
3. Откроется страница функции

### Способ 2: Через прямую ссылку

1. Скопируйте ссылку:
   ```
   https://console.yandex.cloud/folders/b1gv03a122le5a934cqj/functions/d4erd8d1pttbufsl26s1
   ```
2. Вставьте в адресную строку браузера и нажмите Enter
3. Откроется страница функции

**Примечание**: Если идентификатор функции отличается (например, `d4erd8d1pttbufs126s1` вместо `d4erd8d1pttbufsl26s1`), используйте правильный идентификатор из таблицы.

## Шаг 2: Выбрать среду выполнения

Вы попали на страницу создания версии функции. На экране отображается:

**"Создайте первую версию функции"**
**"Прежде чем перейти к созданию первой версии функции, выберите среду выполнения."**

1. В сетке карточек со средами выполнения найдите **Node.js**
2. **Кликните на карточку "Node.js"** (версия 22)
   - После клика карточка должна выделиться
3. **Снимите галочку** с чекбокса **"Добавить файлы с примерами кода"** (если он отмечен)
   - Это важно, чтобы не добавлять лишний пример кода
4. Нажмите кнопку **"Продолжить"** (она станет активной после выбора Node.js)
5. Откроется следующий экран с редактором кода

## Шаг 3: Вставить код функции

После нажатия "Продолжить" откроется редактор кода:

1. Найдите область редактора кода (обычно в центре страницы)
2. Если там есть пример кода — **удалите его полностью**
3. Откройте файл `docs/ya-cloud-function-code.md` в вашем проекте
4. Скопируйте **весь код** из файла (от `// index.js` до последней закрывающей скобки)
5. Вставьте код в редактор

## Шаг 4: Вставить код функции

1. Откройте файл `docs/ya-cloud-function-code.md` в вашем проекте
2. Скопируйте **весь код** из файла (от `// index.js` до последней закрывающей скобки)
3. Вставьте код в редактор на странице создания версии

**⚠️ ВАЖНО**: Используйте код из `docs/ya-cloud-function-code.md`, а не из инструкции ИИ-ассистента!

## Шаг 5: Настроить переменные окружения

1. Прокрутите страницу вниз до раздела **"Переменные окружения"**
2. Нажмите кнопку **"Добавить"** или **"Добавить переменную"**
3. В поле **"Ключ"** введите: `YANDEX_API_KEY`
4. В поле **"Значение"** введите ваш API-ключ (например, `AQVN...` - замените на ваш реальный ключ)
5. Нажмите **"Сохранить"** или кнопку подтверждения

## Шаг 6: Установить таймаут

1. Найдите раздел **"Ресурсы"** или **"Параметры выполнения"**
2. Найдите поле **"Таймаут, с"** или **"Timeout"**
3. Установите значение: **30** секунд
4. Остальные параметры можно оставить по умолчанию:
   - Память: 128 МБ
   - Сервисный аккаунт: не требуется (или оставить пустым)

## Шаг 7: Сохранить и развернуть

1. Прокрутите страницу вниз до кнопки **"Создать версию"** (внизу формы)
2. Нажмите кнопку **"Создать версию"**
3. Дождитесь завершения деплоя
4. Статус должен измениться на **"Активна"**

## Шаг 8: Проверить работу

После успешного создания версии:

1. Откройте файл `ya-cors.html` в браузере
2. В поле **"URL прокси Cloud Function"** введите:
   ```
   https://functions.yandexcloud.net/d4erd8d1pttbufsl26s1
   ```
3. (Опционально) Введите API-ключ, если не сохранен в переменных окружения
4. Введите Folder ID: `b1gv03a122le5a934cqj`
5. Выберите модель и введите тестовый запрос
6. Нажмите **"Отправить запрос"**
7. Проверьте логи на странице — должен быть успешный ответ от YandexGPT

## ССЫЛКИ

- Исправленный код: `docs/ya-cloud-function-code.md`
- План интеграции: `docs/integration-mbb-ya-plan.md`
- Тестовая страница: `ya-cors.html`
