# Протокол работы с libs-репозиторием

> Оглавление `docs/doc-lib-github.md`
- § Активация протокола — когда и как запускается протокол
- § Последовательность действий — пошаговый сценарий работы с libs-репозиторием
- § Структура libs-репозитория — организация файлов и версий
- § Интеграция с MBB — обновление конфигурации в основном проекте

> § <br> АКТИВАЦИЯ ПРОТОКОЛА

## Условия активации
Протокол активируется в следующих случаях:
- При необходимости добавить новую библиотеку в `libs`-репозиторий
- При обновлении версии существующей библиотеки
- При обнаружении, что библиотека отсутствует в `core/lib-loader.js` или `docs/doc-lib-vue.md`
- По явной команде пользователя: "добавить библиотеку в libs", "обновить библиотеку" или аналогичной

## Определение необходимости
Перед активацией протокола проверь:
1. Требуется ли библиотека для текущей задачи
2. Наличие библиотеки в `docs/doc-lib-vue.md`
3. Загружается ли библиотека через `core/lib-loader.js`
4. Есть ли UMD-сборка библиотеки (для работы через CDN)

> § <br> ПОСЛЕДОВАТЕЛЬНОСТЬ ДЕЙСТВИЙ

## Шаг 1: Переключение на libs-репозиторий

### Если workspace содержит оба репозитория
- Работай с папкой `libs` в том же workspace
- В терминале переключись: `cd ../libs` (из MBB) или используй абсолютный путь

### Если libs не открыт в workspace
- Предупреди пользователя о необходимости открыть libs-репозиторий
- Предложи открыть multi-root workspace или переключиться вручную

## Шаг 2: Добавление/обновление библиотеки

### Создание структуры папок
1. Создай структуру: `libs/<library-name>/<version>/`
2. Примеры:
   - `libs/vue/3.4.0/`
   - `libs/chartjs/4.4.0/`
   - `libs/numeral/2.0.6/`

### Загрузка файлов библиотеки
1. Загрузи UMD-сборку библиотеки (не ES modules)
2. Размести файлы в соответствующей папке версии
3. Используй стандартные имена файлов:
   - `vue.global.js` для Vue.js
   - `<library-name>.umd.js` для большинства библиотек
   - `<library-name>.min.js` для минифицированных версий

### Обновление README.md (опционально)
Если требуется, обнови `README.md` в libs-репозитории с описанием новой библиотеки.

## Шаг 3: Обновление конфигурации в MBB

### Возврат в MBB-репозиторий
- Вернись в MBB-репозиторий: `cd ../MBB` (из libs) или используй абсолютный путь

### Обновление core/lib-loader.js
1. Добавь источники для новой библиотеки в `LIB_SOURCES`:
   ```javascript
   '<library-name>': [
       { url: 'https://aoponomarev.github.io/libs/<library-name>/<version>/<file>.js', type: 'github' },
       { url: 'https://cdn.jsdelivr.net/npm/<library-name>@<version>/dist/<file>.js', type: 'jsdelivr' },
       { url: 'https://cdnjs.cloudflare.com/ajax/libs/<library-name>/<version>/<file>.js', type: 'cdnjs' },
       { url: './libs/<library-name>@<version>.js', type: 'local' }
   ]
   ```
2. Порядок источников: GitHub Pages → jsdelivr → cdnjs → local

### Обновление docs/doc-lib-vue.md
1. Добавь описание библиотеки в соответствующий раздел (критически важные, очень полезные, полезные)
2. Укажи:
   - Назначение библиотеки
   - Версию
   - Расширяемость (плагины, composables, кастомизация)
   - Источники загрузки
   - Примечания (если есть)

## Шаг 4: Коммит изменений

### Порядок коммитов
1. **Сначала** закоммить изменения в libs-репозитории (если есть изменения):
   - Переключись в libs: `cd ../libs`
   - `git add .`
   - `git commit -m "Добавлена библиотека <name> версии <version>"`
   - `git push` (если требуется)

2. **Затем** закоммить изменения в MBB-репозитории:
   - Вернись в MBB: `cd ../MBB`
   - Следуй протоколу коммитов из `.cursorrules`
   - Обнови соответствующие тематические логи

### Важно
- Не коммить изменения в libs без явной команды пользователя (следуй общему правилу о коммитах)
- При работе с libs всегда возвращайся в MBB для обновления конфигурации
- Документируй все изменения библиотек в `docs/doc-lib-vue.md`

> § <br> СТРУКТУРА LIBS-РЕПОЗИТОРИЯ

## Организация файлов
```
libs/
├── <library-name>/
│   └── <version>/
│       └── <file>.js
├── README.md
└── index.html
```

## Правила именования
- Папки библиотек: kebab-case (`vue-chartjs`, `vuedraggable`)
- Папки версий: семантическое версионирование (`3.4.0`, `4.4.0`)
- Файлы: стандартные имена UMD-сборок

## Версионирование
- Каждая версия библиотеки хранится в отдельной папке
- Старые версии не удаляются (для совместимости)
- Новые версии добавляются без изменения существующих

> § <br> ИНТЕГРАЦИЯ С MBB

## Связь между репозиториями
- **libs-репозиторий**: хранит файлы библиотек, раздаёт через GitHub Pages CDN
- **MBB-репозиторий**: использует библиотеки через `core/lib-loader.js`, документирует в `docs/doc-lib-vue.md`

## Обновление после изменений в libs
После добавления/обновления библиотеки в libs:
1. Обнови `core/lib-loader.js` в MBB (добавь источники)
2. Обнови `docs/doc-lib-vue.md` в MBB (добавь описание)
3. Проверь работоспособность загрузки библиотеки

## Проверка доступности
После push в libs-репозиторий проверь доступность через GitHub Pages:
```
https://aoponomarev.github.io/libs/<library-name>/<version>/<file>.js
```

