# Архитектурный план

> Оглавление
1. **Архитектурный план** `docs/architect.md`
   - § *Технологический стек* — используемые технологии и инструменты.
   - § *Принципы модульности* — организация файлов, загрузка модулей, вынос шаблонов.
   - § *Технические ограничения* — критические ограничения и требования.

> § <br> **ТЕХНОЛОГИЧЕСКИЙ СТЕК**

## Среда исполнения
- Приложение развёрнуто на GitHub Pages: только фронтенд, без серверного кода, корректные относительные пути и загрузка ресурсов по HTTPS (без `content://`).

## Фреймворки и UI
- Основной стек: Vue.js + Bootstrap для стилизации.
- Приоритет Bootstrap‑классов и утилит; кастомный CSS, inline‑стили и `<style>`‑блоки использовать минимально.

## Работа фронтенда
- Внешние HTTP‑запросы не запускать вне `#app`, пока сплэш‑экран не разблокирован.
- Компоненты и разметка, управляемые Vue, должны располагаться внутри `<div id="app">`.

## Перенос кода из первоисточников и старых версий
- Сохранять имена, семантику переменных/функций, полезные комментарии.
- Избегать конфликтов имён, комментировать новые переменные и решения.
- При возникновении конфликтов имен переменных — сообщать пользователю с достаточной детализацией, предлагая варианты решения.
- При переносе кода из первоисточников (примеров кода из других проектов) использовать переменные первоисточников в приоритете.
- Переносить комментарии первоисточников с сохранением их сути и контекста, адаптируя при необходимости. Всегда комментировать переменные при их объявлении, указывая их назначение и семантику для понимания другим разработчиком или ИИ-агентом.

> § <br> **ТЕХНИЧЕСКИЕ ОГРАНИЧЕНИЯ**

## Порядок загрузки x-template шаблонов
При использовании `<script type="text/x-template">` для Vue компонентов — шаблон **ОБЯЗАТЕЛЬНО** должен быть в DOM **ДО** загрузки Vue.js и компонентов, которые его используют. Правильный порядок в `index.html`: 1) Bootstrap JS, 2) x-template шаблоны, 3) Vue.js, 4) компоненты, 5) app-ui-root.js. Нарушение порядка приводит к тому, что Vue не находит шаблон при монтировании компонента, и компонент не отображается.

## Размещение компонентов
Vue-монтирует только то, что находится в пределах `#app`, поэтому сплэш-экраны, модалки, новые UI-блоки и контейнеры должны рендериться внутри `<div id="app">`.

## Внешние запросы
Не запускать внешние HTTP-запросы (CoinGecko, CDN и т.п.) или иные операции вне `#app`, пока сплэш экран не разблокирован.

> § <br> **ПРИНЦИПЫ МОДУЛЬНОСТИ**

## Роль index.html
`index.html` служит только точкой подключения всех скриптов и стилей. Вся разметка компонентов, шаблоны и логика вынесены в отдельные модули.

## Вынос x-template шаблонов
- Каждый x-template шаблон выносится в отдельный файл в папке `ui/templates/`
- Формат имени: `<component-name>-template.html`
- Шаблоны загружаются динамически через `fetch()` ДО инициализации Vue.js
- Загрузчик шаблонов: `core/template-loader.js`
- Шаблоны вставляются в DOM как `<script type="text/x-template">` элементы

## Модульная система загрузки скриптов
- Конфигурационный файл `core/modules-config.js` описывает все модули и их зависимости
- Модули группируются по категориям: библиотеки, утилиты, core, domain, features, ui, app
- Загрузчик модулей `core/module-loader.js` читает конфигурацию и загружает модули в правильном порядке
- В `index.html` остаётся только подключение загрузчика модулей

## Группировка компонентов и модулей
- По функциональности (`features/`): markets, portfolios, metrics — каждая feature содержит компоненты, утилиты, шаблоны, стили
- По слоям архитектуры: `core/` (базовые утилиты), `domain/` (бизнес-логика), `ui/` (UI-компоненты), `app/` (корневой компонент)
- По типу файлов: `ui/templates/` (шаблоны), `ui/components/` (Vue компоненты), `ui/styles/` (CSS), `core/api/` (API-утилиты), `ui/api/` (Vue компоненты для API)

## Правила размещения файлов
- Шаблоны: `ui/templates/<component-name>-template.html`
- Компоненты Vue: `ui/components/<component-name>.js` или `ui/features/<feature-name>/<component-name>.js`
- Стили: `ui/styles/<component-name>.css`
- Утилиты API: `core/api/<api-name>.js` (чистые функции, не Vue)
- Компоненты API: `ui/api/<component-name>.js` (Vue компоненты)
- Математические модели: `mm/<model-name>/utils/`, `mm/<model-name>/core/`, `mm/<model-name>/metrics/`

## Порядок загрузки
1. Bootstrap CSS и внешние стили
2. Локальные стили (theme, layout, components)
3. Bootstrap JS
4. Загрузчик шаблонов (`core/template-loader.js`) — загружает все x-template
5. Конфигурация модулей (`core/modules-config.js`)
6. Загрузчик модулей (`core/module-loader.js`) — загружает все скрипты по конфигурации
7. Инициализация приложения (`app/app-ui-root.js`)

## Принципы именования
- Файлы компонентов: kebab-case (`button.js`, `system-messages.js`)
- Файлы шаблонов: kebab-case с суффиксом `-template` (`button-template.html`)
- Файлы утилит: kebab-case (`coingecko.js`, `table-sort-mixin.js`)
- ID шаблонов в DOM: kebab-case (соответствует имени файла без расширения)

## Работа без сборки
Проект должен работать на GitHub Pages (HTTPS) и локально через `file://` протокол без использования bundler'ов. Ограничения: нет ES6 модулей (import/export), использование глобальных переменных через `window.*`, динамическая загрузка через `fetch()` и создание `<script>` тегов, относительные пути к файлам.

