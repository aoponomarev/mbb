# Архитектурный план

> Оглавление `docs/doc-architect.md`
- § Технологический стек
  - *Среда исполнения* — развёртывание на GitHub Pages, фронтенд без серверного кода.
  - *Фреймворки и UI* — Vue.js + Bootstrap, приоритет Bootstrap-классов.
  - *Работа фронтенда* — размещение компонентов в `#app`, порядок загрузки запросов.
  - *Перенос кода из первоисточников и старых версий* — правила сохранения имён, семантики, комментариев.
- § Технические ограничения
  - *Порядок загрузки x-template шаблонов* — критический порядок загрузки шаблонов до Vue.js.
  - *Размещение компонентов* — все Vue-компоненты внутри `<div id="app">`.
  - *Внешние запросы* — запрет запросов вне `#app` до разблокировки сплэш-экрана.
- § Принципы модульности
  - *Роль index.html* — точка подключения скриптов и стилей.
  - *Вынос x-template шаблонов* — шаблоны в отдельных файлах `shared/templates/`.
  - *Модульная система загрузки скриптов* — конфигурация и загрузчик модулей.
  - *Группировка компонентов и модулей* — по функциональности, слоям, типу файлов, декомпозиция компонентов.
  - *Правила размещения файлов* — структура папок для шаблонов, компонентов, стилей, утилит.
  - *Порядок загрузки* — последовательность загрузки стилей, скриптов, шаблонов, модулей.
  - *Принципы именования* — kebab-case для файлов компонентов, шаблонов, утилит.
  - *Работа без сборки* — поддержка GitHub Pages и `file://` без bundler'ов.

> § <br> ТЕХНОЛОГИЧЕСКИЙ СТЕК

## Среда исполнения
- Приложение развёрнуто на GitHub Pages: только фронтенд, без серверного кода, корректные относительные пути и загрузка ресурсов по HTTPS (без `content://`).

## Фреймворки и UI
- Основной стек: Vue.js + Bootstrap для стилизации.
- Приоритет Bootstrap‑классов и утилит; кастомный CSS, inline‑стили и `<style>`‑блоки использовать минимально.

## Работа фронтенда
- Внешние HTTP‑запросы не запускать вне `#app`, пока сплэш‑экран не разблокирован.
- Компоненты и разметка, управляемые Vue, должны располагаться внутри `<div id="app">`.

## Перенос кода из первоисточников и старых версий
- Сохранять имена, семантику переменных/функций, полезные комментарии.
- Избегать конфликтов имён, комментировать новые переменные и решения.
- При возникновении конфликтов имен переменных — сообщать пользователю с достаточной детализацией, предлагая варианты решения.
- При переносе кода из первоисточников (примеров кода из других проектов) использовать переменные первоисточников в приоритете.
- Переносить комментарии первоисточников с сохранением их сути и контекста, адаптируя при необходимости. Всегда комментировать переменные при их объявлении, указывая их назначение и семантику для понимания другим разработчиком или ИИ-агентом.

> § <br> ТЕХНИЧЕСКИЕ ОГРАНИЧЕНИЯ

## Порядок загрузки x-template шаблонов
При использовании `<script type="text/x-template">` для Vue компонентов — шаблон **ОБЯЗАТЕЛЬНО** должен быть в DOM **ДО** загрузки Vue.js и компонентов, которые его используют. Правильный порядок в `index.html`: 1) Bootstrap JS, 2) x-template шаблоны, 3) Vue.js, 4) компоненты, 5) app-ui-root.js. Нарушение порядка приводит к тому, что Vue не находит шаблон при монтировании компонента, и компонент не отображается.

## Размещение компонентов
Vue-монтирует только то, что находится в пределах `#app`, поэтому сплэш-экраны, модалки, новые UI-блоки и контейнеры должны рендериться внутри `<div id="app">`.

## Внешние запросы
Не запускать внешние HTTP-запросы (CoinGecko, CDN и т.п.) или иные операции вне `#app`, пока сплэш-экран не разблокирован.

> § <br> ПРИНЦИПЫ МОДУЛЬНОСТИ

## Роль index.html
`index.html` служит только точкой подключения всех скриптов и стилей. Вся разметка компонентов, шаблоны и логика вынесены в отдельные модули.

## Вынос x-template шаблонов
- Каждый x-template шаблон выносится в отдельный файл в папке `shared/templates/` (переиспользуемые) или `features/<feature-name>/templates/` (feature-specific)
- Формат имени: `<component-name>-template.html`
- Шаблоны загружаются динамически через `fetch()` ДО инициализации Vue.js
- Загрузчик шаблонов: `core/template-loader.js`
- Шаблоны вставляются в DOM как `<script type="text/x-template">` элементы

## Модульная система загрузки скриптов
- Конфигурационный файл `core/modules-config.js` описывает все модули и их зависимости
- Модули группируются по категориям: библиотеки, утилиты, core, domain, features, shared, app
- Загрузчик модулей `core/module-loader.js` читает конфигурацию и загружает модули в правильном порядке
- В `index.html` остаётся только подключение загрузчика модулей

## Группировка компонентов и модулей
- По функциональности (`features/`): markets, settings, layout — каждая feature содержит компоненты, утилиты, шаблоны, стили, конфигурацию
- По слоям архитектуры: `core/` (базовые утилиты), `domain/` (бизнес-логика), `shared/` (переиспользуемые компоненты), `app/` (корневой компонент)
- По типу файлов: `shared/templates/` (переиспользуемые шаблоны), `shared/components/` (переиспользуемые Vue компоненты), `shared/styles/` (общие CSS), `core/api/` (API-утилиты), `features/*/components/` (feature-specific компоненты)
- Разделение shared/feature-specific: `shared/` — переиспользуемые компоненты (button, cell-*, dropdown-menu, menu-item), стили (theme-colors, layout, z-index), утилиты (pluralize, hash-generator, table-sort-mixin), конфигурация (ui-element-mapping), ресурсы (иконки). `features/markets/` — coins-manager, утилиты для CD и избранного, конфигурация таблиц. `features/settings/` — perplexity, import-export. `features/layout/` — header, footer, splash, theme.

## Правила размещения файлов
- Шаблоны: `shared/templates/<component-name>-template.html` (переиспользуемые) или `features/<feature-name>/templates/<component-name>-template.html` (feature-specific)
- Компоненты Vue: `shared/components/<component-name>.js` (переиспользуемые) или `features/<feature-name>/components/<component-name>.js` (feature-specific)
- Стили: `shared/styles/<component-name>.css` (общие) или `features/<feature-name>/styles/<component-name>.css` (feature-specific)
- Утилиты: `shared/utils/<utility-name>.js` (общие) или `features/<feature-name>/utils/<utility-name>.js` (feature-specific)
- Конфигурация: `shared/config/<config-name>.js` (общая) или `features/<feature-name>/config/<config-name>.js` (feature-specific)
- Утилиты API: `core/api/<api-name>.js` (чистые функции, не Vue)
- Математические модели: `mm/<model-name>/utils/`, `mm/<model-name>/core/`, `mm/<model-name>/metrics/`

## Порядок загрузки
1. Bootstrap CSS и внешние стили
2. Локальные стили (theme, layout, components)
3. Bootstrap JS
4. Загрузчик шаблонов (`core/template-loader.js`) — загружает все x-template
5. Конфигурация модулей (`core/modules-config.js`)
6. Загрузчик модулей (`core/module-loader.js`) — загружает все скрипты по конфигурации
7. Инициализация приложения (`app/app-ui-root.js`)

## Принципы именования
- Файлы компонентов: kebab-case (`button.js`, `system-messages.js` и т.д.)
- Файлы шаблонов: kebab-case с суффиксом `-template` (`button-template.html` и т.п.)
- Файлы утилит: kebab-case (`coingecko.js`, `table-sort-mixin.js` и т.д.)
- ID шаблонов в DOM: kebab-case (соответствует имени файла без расширения)
- Файлы документации: префикс `doc-` (`doc-architect.md` и т.п.)
- Файлы тематических логов: префикс `log-` (файлы в папке `docs/logs/`)

## Работа без сборки
Проект должен работать на GitHub Pages (HTTPS) и локально через `file://` протокол без использования bundler'ов. Ограничения: нет ES6 модулей (import/export), использование глобальных переменных через `window.*`, динамическая загрузка через `fetch()` и создание `<script>` тегов, относительные пути к файлам.

