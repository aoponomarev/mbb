# Проблема с SSL в Cloudflare Workers для GigaChat

## Проблема

**Ошибка 526**: Cloudflare Workers не может подключиться к GigaChat OAuth API из-за проблем с SSL сертификатом на порту 9443.

**Причина:**
- Cloudflare Workers **всегда** проверяет SSL сертификаты для внешних запросов в режиме "Full (Strict)"
- Нельзя обойти проверку SSL в Cloudflare Workers (нет аналога `rejectUnauthorized: false`)
- Порт 9443 с проблемным SSL сертификатом блокируется Cloudflare

## Решение: Вернуться к Yandex Cloud Functions

Yandex Cloud Functions **может обойти проверку SSL** через модуль `https` с параметром `rejectUnauthorized: false`, что уже реализовано в коде.

### Преимущества Yandex Cloud Functions для GigaChat:

1. ✅ **Можно обойти проверку SSL** - используем `https` модуль с `rejectUnauthorized: false`
2. ✅ **Работает с портом 9443** - нет проблем с нестандартными портами
3. ✅ **Уже работает** - код готов, только нужно настроить таймаут

### Настройка таймаута:

**ВАЖНО**: GigaChat API может отвечать медленно (60-180+ секунд), поэтому:

1. Откройте функцию `gigachat-proxy` в Yandex Cloud Console
2. Перейдите в **"Настройки"** → **"Параметры выполнения"**
3. Установите **"Таймаут, с"**: `300` секунд (5 минут) или `600` секунд (10 минут - максимум)
4. Сохраните и создайте новую версию

**Это нормально** - GigaChat API медленный, но ответ приходит в течение 2-5 минут, что приемлемо.

### Альтернативное решение (если таймауты критичны):

Если даже 5-10 минут слишком долго, можно разделить на два прокси:

1. **OAuth прокси** (Yandex Cloud Functions) - только для получения токена (~10-20 сек)
2. **Chat API прокси** (Cloudflare Workers) - для быстрых запросов к Chat API

Но это усложняет архитектуру. Рекомендуется использовать Yandex Cloud Functions с увеличенным таймаутом.

## Сравнение решений

| Решение | Работает с SSL 9443 | Таймаут | Сложность |
|---------|-------------------|---------|-----------|
| Cloudflare Workers | ❌ Ошибка 526 | 30 сек | Простая |
| Yandex Cloud Functions | ✅ Работает | 600 сек (10 мин) | Простая |
| Разделенные прокси | ✅ Работает | Гибкий | Сложная |

## Рекомендация

**Вернуться к Yandex Cloud Functions** с таймаутом 300-600 секунд. Это самое простое и рабочее решение.

## ССЫЛКИ

- Код для Yandex Cloud Functions: `giga-ycf-code-ready.md`
- Быстрый старт: `giga-ycf-quick-start.md`
- Настройка таймаута: раздел "Шаг 4: Таймаут" в `giga-ycf-quick-start.md`
