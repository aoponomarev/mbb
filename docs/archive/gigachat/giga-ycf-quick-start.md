# Быстрый старт: GigaChat прокси в Yandex Cloud Functions

> Краткая инструкция на основе уже работающего прокси YandexGPT

## ⚠️ ВАЖНО

Создаем **НОВУЮ** функцию специально для GigaChat. Не трогаем существующую функцию YandexGPT!

- **Существующая функция YandexGPT**: `yandexgpt-proxy` (ID: `d4erd8d1pttbufsl26s1`) - **НЕ ТРОГАЕМ**
- **Новая функция для GigaChat**: `mbb-gigachat-proxy` - создаем с нуля

## Известные данные

- **Folder ID**: `b1gv03a122le5a934cqj` (тот же каталог, что для YandexGPT)
- **Структура**: Аналогична прокси YandexGPT
- **Единый источник правды**: Конфигурация в `core/config/app-config.js`

## Шаг 1: Создание новой функции

1. Откройте Yandex Cloud Console: https://console.yandex.cloud
2. Перейдите в **Serverless** → **Cloud Functions**
3. Нажмите **"Создать функцию"**
4. Заполните:
   - **Имя**: `mbb-gigachat-proxy` (или другое, но отличное от `yandexgpt-proxy`)
   - **Описание**: `Прокси для GigaChat API с поддержкой CORS и OAuth`
   - **Каталог**: выберите тот же каталог, где находится функция YandexGPT
5. Нажмите **"Создать"**
6. Выберите среду выполнения: **Node.js** (версия 18 или новее)
7. **Снимите галочку** "Добавить файлы с примерами кода"
8. Нажмите **"Продолжить"**

Теперь у вас открыт редактор кода для **НОВОЙ** функции GigaChat.

## Шаг 2: Вставка кода

1. Откройте файл `giga-ycf-code-ready.md`
2. Скопируйте весь код из блока ```javascript
3. Вставьте в редактор Yandex Cloud Functions (замените весь существующий код)

**Код уже готов** - это адаптированная версия рабочего прокси YandexGPT.

## Шаг 3: Переменные окружения

1. В редакторе прокрутите вниз до раздела **"Переменные окружения"**
2. Нажмите **"Добавить"**
3. Заполните:
   - **Ключ**: `GIGACHAT_AUTH_KEY`
   - **Значение**: ваш Authorization Key (Base64) из `giga-get-api-key.md`
   - **Тип**: "Секрет" (если доступно)
4. Нажмите **"Сохранить"**

**Важно**: Authorization Key должен быть в формате Base64 (Client ID:Client Secret).

## Шаг 4: Таймаут

1. Найдите раздел **"Ресурсы"** или **"Параметры выполнения"**
2. Установите **"Таймаут, с"**: `300` секунд (5 минут)
   - **ВАЖНО**: GigaChat API может отвечать медленно (30-180+ секунд)
   - OAuth запрос: ~10-20 секунд
   - Chat API запрос: может занимать 60-180+ секунд в зависимости от сложности запроса
   - Таймаут 5 минут (300 секунд) достаточен для большинства запросов

## Шаг 5: HTTP-триггер

1. Перейдите в раздел **"Триггеры"**
2. Создайте HTTP-триггер (если еще не создан):
   - Тип: HTTP
   - Метод: POST, OPTIONS
3. **Скопируйте URL функции** (формат: `https://functions.yandexcloud.net/...`)
   - Понадобится для следующих шагов

## Шаг 6: Публичный доступ

1. На странице функции найдите переключатель **"Публичная функция"**
2. **ВКЛЮЧИТЕ** его (должен быть зеленый/активный)

**Критично**: Без публичного доступа функция недоступна из браузера!

## Шаг 7: Создание версии

1. Прокрутите вниз до кнопки **"Создать версию"**
2. Нажмите **"Создать версию"**
3. Дождитесь завершения деплоя
4. Статус должен стать **"Активна"**

## Следующий шаг

После создания функции:
1. У вас будет URL функции (например: `https://functions.yandexcloud.net/xxxxx`)
2. Нужно обновить конфигурацию в `core/config/app-config.js`:
   ```javascript
   gigachat: {
       proxies: {
           yandex: {
               url: 'https://functions.yandexcloud.net/xxxxx', // ← ваш URL
               // ...
           }
       }
   }
   ```

## Тестирование

После обновления конфигурации:
1. Откройте `giga-cors.html` в браузере
2. Введите URL прокси
3. Отправьте тестовый запрос
4. Проверьте логи функции на наличие ошибок

## ССЫЛКИ

- Готовый код: `giga-ycf-code-ready.md`
- Получение API ключа: `giga-get-api-key.md`
- Тестовая страница: `docs/archive/gigachat/giga-cors.html`
