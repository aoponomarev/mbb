# Настройка переменных окружения в Cloudflare Workers

## Пошаговая инструкция

### Шаг 1: Открыть Worker в редакторе

1. Войдите в Cloudflare Dashboard: https://dash.cloudflare.com
2. Выберите ваш аккаунт
3. Перейдите в раздел **"Workers & Pages"** (или **"Workers"** в старом интерфейсе)
4. Найдите ваш Worker (например, `gigachat-proxy`)
5. **Кликните на имя Worker** - откроется редактор

### Шаг 2: Перейти в настройки переменных окружения

В редакторе Worker есть два способа:

**Способ 1 (через вкладки):**
1. В верхней части страницы найдите вкладки: **"Code"**, **"Settings"**, **"Variables"**, **"Triggers"** и т.д.
2. Нажмите на вкладку **"Variables"** (или **"Settings"** → затем **"Variables"**)

**Способ 2 (через меню Settings):**
1. Нажмите на вкладку **"Settings"**
2. В левом меню найдите раздел **"Variables"**
3. Перейдите в подраздел **"Environment Variables"**

### Шаг 3: Добавить переменную окружения

1. В разделе **"Environment Variables"** (Переменные окружения) найдите кнопку:
   - **"Add variable"** или
   - **"Add environment variable"** или
   - **"Добавить переменную"**

2. Заполните форму:
   - **Variable name** (Имя переменной): `GIGACHAT_AUTH_KEY`
   - **Value** (Значение): вставьте ваш Authorization Key (Base64 строка)
   - **Type** (Тип): выберите **"Secret"** (рекомендуется) или **"Plain text"**

3. Нажмите **"Save"** или **"Сохранить"**

### Шаг 4: Развернуть Worker

**ВАЖНО**: После добавления переменных окружения нужно **переразвернуть Worker**:

1. Вернитесь на вкладку **"Code"**
2. Нажмите кнопку **"Save and deploy"** (Сохранить и развернуть) в правом верхнем углу
3. Дождитесь сообщения об успешном развертывании

### Шаг 5: Проверка

Чтобы убедиться, что переменная установлена:

1. Перейдите на вкладку **"Variables"** снова
2. В списке переменных должна быть `GIGACHAT_AUTH_KEY` с типом **"Secret"** (значение скрыто)
3. Если переменная видна - все настроено правильно

## Важные замечания

### Тип переменной: Secret vs Plain text

- **Secret**: Значение скрыто в интерфейсе, безопаснее для API ключей (рекомендуется)
- **Plain text**: Значение видно в интерфейсе, менее безопасно

**Рекомендация**: Всегда используйте **Secret** для API ключей!

### Где брать Authorization Key?

1. Откройте файл `docs/archive/gigachat/giga-get-api-key.md`
2. Следуйте инструкциям для получения Base64 ключа
3. Скопируйте ключ и вставьте в поле **"Value"**

### Формат ключа

Authorization Key должен быть в формате **Base64** (без префикса "Basic "):
```
MDE5Yjc0NG... (длинная строка символов)
```

### Проверка работы

После настройки переменных:

1. Откройте `docs/archive/gigachat/giga-cors.html` в браузере
2. Введите URL вашего Worker: `https://your-worker-name.your-subdomain.workers.dev`
3. Отправьте тестовый запрос
4. Если появляется ошибка "Authorization Key не настроен" - проверьте:
   - Правильно ли названа переменная: `GIGACHAT_AUTH_KEY` (точное совпадение!)
   - Переразвернут ли Worker после добавления переменной
   - Включен ли Worker (статус "Active")

## Альтернатива: Wrangler CLI

Если используете Wrangler CLI локально, можно настроить переменные через `wrangler.toml`:

```toml
[env.production.vars]
GIGACHAT_AUTH_KEY = "your-base64-key-here"
```

Или через команду:
```bash
wrangler secret put GIGACHAT_AUTH_KEY
```

## ССЫЛКИ

- Код Worker: `giga-oauth-proxy-code.md` (раздел "Вариант 1: Cloudflare Workers")
- Получение API ключа: `giga-get-api-key.md`
- Альтернативное решение: `giga-cloudflare-alternative.md`
